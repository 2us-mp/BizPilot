<!DOCTYPE html>
<html>
<head>
    <title>BizPilot – Onboarding</title>
    <script src="https://js.stripe.com/v3/"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body { margin: 0; font-family: "Inter", sans-serif; background: #f3f5fa; display: flex; justify-content: center; padding: 40px; }
        .container { width: 95%; max-width: 500px; background: white; border-radius: 14px; padding: 28px;
            box-shadow: 0 5px 18px rgba(0,0,0,0.15); }
        h1 { text-align: center; margin-bottom: 5px; font-size: 26px; }
        input, textarea {
            width: 100%; padding: 14px; margin-top: 10px; border-radius: 8px;
            border: 1px solid #cfd3dc; font-size: 16px;
        }
        .plan { padding: 14px; border-radius: 10px; border: 2px solid #d6d9e6; margin-bottom: 14px; cursor: pointer; transition: 0.20s; }
        .plan:hover { border-color: #5b7bff; background: #f5f7ff; }
        .selected { border-color: #3758ff !important; background: #eef1ff !important; }
        button {
            width: 100%; padding: 15px; margin-top: 14px; background: #3758ff; border: none;
            color: white; font-size: 18px; border-radius: 8px; cursor: pointer; transition: 0.15s;
        }
        #status, #finalStatus { text-align: center; margin-top: 10px; color: #111; font-weight: bold; }
        .link { color:#3758ff; text-align:center; cursor:pointer; margin-top:12px; }
    </style>
</head>
<body>

<!-- LOGIN -->
<div class="container" id="step_login">
    <h1>Login to BizPilot</h1>
    <input id="login_email" placeholder="Email">
    <input id="login_password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p class="link" onclick="showSignup()">Don't have an account? Sign up</p>
    <p id="loginStatus"></p>
</div>

<!-- SIGNUP -->
<div class="container" id="step_signup" style="display:none;">
    <h1>Create an Account</h1>
    <input id="signup_email" placeholder="Email">
    <input id="signup_password" type="password" placeholder="Password">
    <button onclick="signup()">Sign Up</button>
    <p class="link" onclick="showLogin()">Already have an account? Login</p>
    <p id="signupStatus"></p>
</div>

<!-- PLAN SELECTION -->
<div class="container" id="step_plans" style="display:none;">
    <h1>Choose Your Plan</h1>

    <div class="plan" data-amount="1999" onclick="selectPlan(this)">
        <h3>Starter – $19.99/mo</h3>
    </div>

    <div class="plan" data-amount="4999" onclick="selectPlan(this)">
        <h3>Standard – $49.99/mo</h3>
    </div>

    <div class="plan" data-amount="9999" onclick="selectPlan(this)">
        <h3>Pro – $99.99/mo</h3>
    </div>

    <div class="plan" data-amount="custom" onclick="selectPlan(this)">
        <h3>Enterprise – Custom Price</h3>
    </div>

    <input id="customAmount" style="display:none;" placeholder="Enter custom monthly price">

    <button onclick="goToPayment()">Continue</button>
    <p id="planStatus"></p>
</div>

<!-- PAYMENT -->
<div class="container" id="step_payment" style="display:none;">
    <h1>Payment Information</h1>
    <p id="paymentAmount"></p>

    <div id="card-element"></div>

    <button id="payBtn">Submit Payment</button>
    <p id="status"></p>
</div>

<!-- REQUEST -->
<div class="container" id="step_request" style="display:none;">
    <h1>Your Project Request</h1>
    <textarea id="details" placeholder="Describe what you want BizPilot to create or help with..."></textarea>
    <button onclick="submitRequest()">Submit Request</button>
    <p id="finalStatus"></p>
</div>

<script>
    const API_URL = "https://bizpilot.onrender.com";
    const STRIPE_BACKEND = "https://YOUR_STRIPE_BACKEND_URL_HERE";
    const STRIPE_PUBLIC_KEY = "pk_live_51ReQgoHwN7YkNv6zwRaz8N1GO0PL7Bb3pqUbcxhss5cQQpJFKjoiNJR4DWKeTRWwhw2tmejOtXjbnrIg6sHnhxc600ePIEIgBc";

    const stripe = Stripe(STRIPE_PUBLIC_KEY);
    const elements = stripe.elements();
    const card = elements.create("card");
    card.mount("#card-element");

    let selectedAmount = null;

    function showSignup() {
        document.getElementById("step_login").style.display = "none";
        document.getElementById("step_signup").style.display = "block";
    }

    function showLogin() {
        document.getElementById("step_signup").style.display = "none";
        document.getElementById("step_login").style.display = "block";
    }

    async function signup() {
        const email = document.getElementById("signup_email").value.trim();
        const password = document.getElementById("signup_password").value.trim();

        document.getElementById("signupStatus").innerText = "Creating account...";

        const result = await fetch(`${API_URL}/signup`, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ email, password })
        }).then(r => r.json());

        if (result.success) {
            document.getElementById("signupStatus").innerText = "Account created! You may now log in.";
        } else {
            document.getElementById("signupStatus").innerText = result.error || "Signup failed.";
        }
    }

    async function login() {
        const email = document.getElementById("login_email").value.trim();
        const password = document.getElementById("login_password").value.trim();

        document.getElementById("loginStatus").innerText = "Logging in...";

        const result = await fetch(`${API_URL}/login`, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ email, password })
        }).then(r => r.json());

        if (result.token) {
            localStorage.setItem("bizpilot_token", result.token);
            document.getElementById("step_login").style.display = "none";
            document.getElementById("step_signup").style.display = "none";
            document.getElementById("step_plans").style.display = "block";
        } else {
            document.getElementById("loginStatus").innerText = "Invalid credentials.";
        }
    }

    function selectPlan(el) {
        document.querySelectorAll(".plan").forEach(p => p.classList.remove("selected"));
        el.classList.add("selected");

        const amount = el.getAttribute("data-amount");
        if (amount === "custom") {
            selectedAmount = "custom";
            document.getElementById("customAmount").style.display = "block";
        } else {
            selectedAmount = parseInt(amount);
            document.getElementById("customAmount").style.display = "none";
        }
    }

    function goToPayment() {
        if (!selectedAmount) {
            document.getElementById("planStatus").innerText = "Choose a plan.";
            return;
        }

        if (selectedAmount === "custom") {
            const c = parseFloat(document.getElementById("customAmount").value);
            if (isNaN(c) || c <= 0) {
                document.getElementById("planStatus").innerText = "Enter valid amount.";
                return;
            }
            selectedAmount = Math.round(c * 100);
        }

        document.getElementById("paymentAmount").innerText = "You will be charged $" + (selectedAmount / 100).toFixed(2);
        document.getElementById("step_plans").style.display = "none";
        document.getElementById("step_payment").style.display = "block";
    }

    document.getElementById("payBtn").addEventListener("click", async () => {
        document.getElementById("status").innerText = "Processing payment...";

        const paymentIntent = await fetch(`${STRIPE_BACKEND}/create-payment-intent`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                amount: selectedAmount,
                description: "BizPilot Subscription"
            })
        }).then(r => r.json());

        const result = await stripe.confirmCardPayment(paymentIntent.clientSecret, {
            payment_method: { card: card }
        });

        if (result.error) {
            document.getElementById("status").innerText = result.error.message;
        } else {
            document.getElementById("step_payment").style.display = "none";
            document.getElementById("step_request").style.display = "block";
        }
    });

    async function submitRequest() {
        const text = document.getElementById("details").value.trim();
        const token = localStorage.getItem("bizpilot_token");

        const result = await fetch(`${API_URL}/submit-request`, {
            method: "POST",
            headers: { 
                "Content-Type": "application/json",
                "Authorization": token
            },
            body: JSON.stringify({ requestText: text })
        }).then(r => r.json());

        document.getElementById("finalStatus").innerText = "Request submitted!";
    }
</script>

</body>
</html>
